<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CE Agent</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

    :root {
      --primary: #2563eb;
      --secondary: #4b5563;
      --accent: #16a34a;
      --light: #f9fafb;
      --light-gray: #e5e7eb;
      --dark-blue: #1e40af;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--light);
      color: #1f2937;
      margin: 0;
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      max-width: 860px;
      width: 100%;
      background: white;
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.06);
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .header img {
      height: 48px;
    }

    .header h1 {
      color: var(--primary);
      font-size: 2.2rem;
      font-weight: 700;
      margin: 0;
    }

    p {
      text-align: center;
      color: #555;
      margin: 0 0 24px;
      font-size: 1rem;
    }

    pre {
      background: var(--light-gray);
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 0.9rem;
      overflow-x: auto;
      user-select: all;
      margin: 10px auto 30px;
      width: fit-content;
    }

    textarea {
      width: 100%;
      min-height: 160px;
      font-family: monospace;
      font-size: 14px;
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      resize: vertical;
      transition: all 0.25s ease;
    }

    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px #bfdbfe;
      outline: none;
    }

    .button-row {
      margin-top: 24px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.95rem;
      border: none;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.1s ease;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn-secondary {
      background: var(--secondary);
      color: white;
    }

    .btn-secondary:hover {
      background: #374151;
    }

    #output {
      background: #eef2ff;
      padding: 30px;
      margin-top: 30px;
      border-radius: 14px;
      border: 1px solid #c7d2fe;
      font-family: monospace;
      font-size: 14px;
      color: var(--dark-blue);
      box-shadow: 0 6px 16px rgba(30, 64, 175, 0.08);
      max-height: 400px;
      overflow-y: auto;
    }

    .group {
      margin-bottom: 20px;
      border-bottom: 1px solid #dbeafe;
      padding-bottom: 14px;
    }

    .group label {
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--dark-blue);
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }

    .emails {
      margin-left: 28px;
      margin-top: 8px;
      color: #334155;
      white-space: pre-wrap;
      line-height: 1.5;
      font-size: 13px;
    }

    #emailBodyContainer {
      margin-top: 30px;
    }

    #sendEmailContainer {
      margin-top: 24px;
      text-align: center;
    }

    #sendEmailBtn {
      background: var(--accent);
      color: white;
      padding: 14px 36px;
      border: none;
      font-weight: 700;
      font-size: 1.1rem;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 6px 12px rgba(5, 150, 105, 0.3);
    }

    #sendEmailBtn:hover {
      background: #15803d;
      box-shadow: 0 8px 16px rgba(5, 150, 105, 0.5);
    }

    h2 {
      font-size: 1.4rem;
      color: var(--primary);
      margin-top: 40px;
    }

    label[for="customEmailBody"] {
      font-weight: 600;
      display: block;
      margin-bottom: 10px;
      color: #1f2937;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="logoc.png" alt="Logo">
      <h1>CE Agent</h1>
    </div>

<div id="exampleToggle" style="text-align: right; margin-bottom: 10px;">
  <button onclick="toggleExample()" style="background: none; border: none; color: var(--primary); cursor: pointer; font-size: 0.95rem; display: flex; align-items: center; gap: 6px;">
    <span style="font-size: 1.2rem;">‚ÑπÔ∏è</span> Show example
  </button>
</div>

<div id="exampleContent" style="display: none; margin-bottom: 20px;">
  <p><strong>Expected format:</strong> BGTeams (separated by `;`) followed by a tab or at least two spaces, then the property group.</p>
  <pre>=Test1; =Test2; =Test3    Azure Compute EMEA
=Test10; =Test11; =Test12    Exchange</pre>
</div>

<textarea id="inputData" placeholder="Paste your data here..."></textarea>



    <div class="button-row">
      <button class="btn btn-primary" onclick="processData()">Run Script</button>
      <button class="btn btn-secondary" onclick="copyOutput()">Copy Result</button>
    </div>

    <h2>Result:</h2>
    <div id="output" aria-live="polite" aria-atomic="true"></div>

    <div id="emailBodyContainer">
      <label for="customEmailBody">Custom email body:</label>
      <textarea id="customEmailBody" placeholder="Write your message here..." style="height: 120px;"></textarea>
    </div>

    <div id="sendEmailContainer">
      <button id="sendEmailBtn" onclick="sendEmails()">Send Email</button>
    </div>
  </div>

  <script>
    let groupDataGlobal = {};

    function processData() {
      const input = document.getElementById('inputData').value.trim();
      const outputDiv = document.getElementById('output');
      outputDiv.innerHTML = '';
      groupDataGlobal = {};

      if (!input) {
        alert('Please paste some data.');
        return;
      }

      const lines = input.split('\n');

      lines.forEach(line => {
        const parts = line.split(/\t+|\s{2,}/);
        if (parts.length < 2) return;

        const bgTeamRaw = parts[0].trim();
        const propertyGroup = parts[1].trim();

        if (!propertyGroup || !bgTeamRaw) return;

        if (!groupDataGlobal[propertyGroup]) {
          groupDataGlobal[propertyGroup] = new Set();
        }

        const values = bgTeamRaw.split(';');
        values.forEach(val => {
          const clean = val.trim().replace(/^=/, '');
          if (clean) {
            groupDataGlobal[propertyGroup].add(clean.toLowerCase() + '@microsoft.com');
          }
        });
      });

      if (Object.keys(groupDataGlobal).length === 0) {
        outputDiv.textContent = 'No valid data found.';
        return;
      }

      for (const group in groupDataGlobal) {
        const emails = Array.from(groupDataGlobal[group]).sort();
        const groupDiv = document.createElement('div');
        groupDiv.classList.add('group');

        const label = document.createElement('label');
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.checked = true;
        checkbox.value = group;
        checkbox.classList.add('group-checkbox');

        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(group));
        groupDiv.appendChild(label);

        const emailsDiv = document.createElement('div');
        emailsDiv.classList.add('emails');
        emailsDiv.textContent = emails.join('\n');
        groupDiv.appendChild(emailsDiv);

        outputDiv.appendChild(groupDiv);
      }
    }

    function sendEmails() {
      const checkboxes = document.querySelectorAll('.group-checkbox:checked');
      if (checkboxes.length === 0) {
        alert('Please select at least one group to send emails.');
        return;
      }

      const customBody = document.getElementById('customEmailBody').value.trim();

      checkboxes.forEach(cb => {
        const group = cb.value;
        const emails = Array.from(groupDataGlobal[group]);
        if (emails.length === 0) return;

        const subject = `Group: ${group}`;
        const bodyContent = customBody || `Hello ${group} team,\n\n`;

        const mailto = `mailto:${emails.join(',')}` +
          `?subject=${encodeURIComponent(subject)}` +
          `&body=${encodeURIComponent(bodyContent)}`;

        window.open(mailto);
      });
    }

    function copyOutput() {
      if (!groupDataGlobal || Object.keys(groupDataGlobal).length === 0) {
        alert('No result to copy. Please process data first.');
        return;
      }
      const outputDiv = document.getElementById('output');
      const textToCopy = Array.from(document.querySelectorAll('.group')).map(g => {
        const groupName = g.querySelector('label').textContent.trim();
        const emails = g.querySelector('.emails').textContent.trim();
        return `${groupName}:\n${emails}\n`;
      }).join('\n');

      navigator.clipboard.writeText(textToCopy.trim())
        .then(() => alert('Result copied to clipboard!'))
        .catch(() => alert('Failed to copy. Please try manually.'));
    }

    function toggleExample() {
  const content = document.getElementById('exampleContent');
  const button = document.querySelector('#exampleToggle button');

  if (content.style.display === 'none') {
    content.style.display = 'block';
    button.innerHTML = '<span style="font-size: 1.2rem;">üîΩ</span> Hide example';
  } else {
    content.style.display = 'none';
    button.innerHTML = '<span style="font-size: 1.2rem;">‚ÑπÔ∏è</span> Show example';
  }
}


  </script>
</body>
</html>
